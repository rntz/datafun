\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{rntzfont}[2018/05/10]
\RequirePackage{etoolbox}       %for \ifdefstring

%% serif font options
\DeclareOption{baskerville}{\def\rntz@font{baskerville}}
\DeclareOption{charter}{\def\rntz@font{charter}}
\DeclareOption{cm}{\def\rntz@font{cm}}
\DeclareOption{cochineal}{\def\rntz@font{cochineal}}
\DeclareOption{fbb}{\def\rntz@font{fbb}}
\DeclareOption{libertine}{\def\rntz@font{libertine}}
\DeclareOption{palatino}{\def\rntz@font{palatino}}
\DeclareOption{pt}{\def\rntz@font{pt}}

%% math font options
\DeclareOption{newmath}{\def\rntz@mathfont{newmath}}
\DeclareOption{euler}{\def\rntz@mathfont{euler}}

\ExecuteOptions{palatino,euler} % default options
\ProcessOptions\relax

%% inconsolata[varqu] - Uses straight double & single quotes.
%% Other options I haven't used:
%% - varl makes l not vertical, ugh.
%% - var0 removes the slash in 0, which is less clear for code.
\PassOptionsToPackage{varqu}{inconsolata}

%% newtxmath[vvarbb] - A more readable variant blackboard bold.
%% Other useful options to newtxmath:
%% baskerv{aldx,ille}, libertine, cochineal, utopia.
\PassOptionsToPackage{vvarbb}{newtxmath}
\PassOptionsToPackage{vvarbb}{newpxmath}

%% TO CONSIDER:
%\PassOptionsToPackage{euler-digits}{eulervm}
%\usepackage[cal=boondoxo]{mathalfa} % adjusts mathcal
%\usepackage[full]{textcomp} % what does this do?

% Baskervaldx is too heavy, baskervillef is way too light. I like
% librebaskerville, but it doesn't have small caps :(.
\ifdefstring{\rntz@font}{baskerville}{
  %\RequirePackage[p,osf,scaled=1.0526]{Baskervaldx}
  \RequirePackage[scaled=0.86315]{librebaskerville}
  \RequirePackage[p,osf,scaled=1.0526]{biolinum}
  \RequirePackage[scaled=.995]{inconsolata}
  \ifdefstring{\rntz@mathfont}{euler}{\RequirePackage{eulervm}}{
    \RequirePackage[libertine,scaled=1.0526]{newtxmath}
    %\RequirePackage[baskerville,scaled=1.0711]{newtxmath}
    %\RequirePackage[baskervaldx,scaled=1.0526]{newtxmath}
  }
  \linespread{1.11}
}{}

\ifdefstring{\rntz@font}{charter}{
  %% %% The charter package can't be scaled to match Euler's x-height. On the
  %% %% other hand, it doesn't require me to install texlive-lang-cyrillic.
  %% \RequirePackage{charter}
  %% \RequirePackage[semibold,scaled=.99]{sourcesanspro}
  %% \RequirePackage[scale=1.05263]{inconsolata}

  %% XCharter can be scaled. It also has ``proper'' small caps, but I think they
  %% actually look worse? Bad kerning, maybe. It has an option [osf] for
  %% old-style proportional figures, but lacks proportional lining figures, and
  %% doesn't respect fontaxes' \tbfigures or \lnfigures.
  \RequirePackage[osf,scaled=0.967]{XCharter}
  \RequirePackage[osf,proportional,semibold,scaled=.955]{sourcesanspro}
  \RequirePackage[scaled=1.019]{inconsolata}

  %% Biolinum doesn't really look like Charter, and besides, matching its
  %% x-height to Charter makes its capitals too large. I'd like to use lato, but
  %% it lacks small caps. Other sans-serif options:
  %\RequirePackage[defaultsans,oldstyle,proportional,scale=0.92]{lato}
  %\RequirePackage[scale=0.935,semibold]{plex-sans}
  %\RequirePackage[scaled=0.896]{noto}

  \ifdefstring{\rntz@mathfont}{euler}{\RequirePackage{eulervm}}{
    \RequirePackage[xcharter,scaled=1.05]{newtxmath}
    % But now \mathcal is badly scaled :(
  }
  \linespread{1.10238}
}{}

\ifdefstring{\rntz@font}{cm}{\linespread{1.05}}{}

\ifdefstring{\rntz@font}{cochineal}{
  \RequirePackage[p,osf,scale=1.08]{cochineal}
  \RequirePackage[p,osf,scaled=1.065]{biolinum}
  \RequirePackage[scaled=1.015]{inconsolata}
  %% TODO: test cochineal,newmath!
  \ifdefstring{\rntz@mathfont}{euler}{\RequirePackage{eulervm}}
              {\RequirePackage[cochineal,scaled=1.08]{newtxmath}}
  \linespread{1.15} % 1.12-1.15 is a good range.
}{}

\ifdefstring{\rntz@font}{fbb}{
  \RequirePackage[p,osf]{fbb}
  \RequirePackage[p,osf,scaled=1.02]{biolinum}
  \RequirePackage[scaled=0.965]{inconsolata}
  \ifdefstring{\rntz@mathfont}{euler}
              {\RequirePackage[small]{eulervm}}
              {\RequirePackage[cochineal,scaled=1.03]{newtxmath}}
  
  \linespread{1.1}
}{}

\ifdefstring{\rntz@font}{libertine}{
  % libertine[osf] makes newtxmath use old-style figures in math mode :(
  % Other options: semibold.
  \RequirePackage[p,mono=false,llscale=1.0526,scale=1.0526]{libertine}
  \RequirePackage[scaled=.995]{inconsolata}
  \ifdefstring{\rntz@mathfont}{euler}
              {\RequirePackage{eulervm}}
              {\RequirePackage[libertine,scaled=1.0526]{newtxmath}}
  \linespread{1.11}
}{}

\ifdefstring{\rntz@font}{palatino}{
  \RequirePackage{newpxtext}
  \RequirePackage[scaled=1.067]{biolinum}
  \RequirePackage[scaled=1.012]{inconsolata}
  \ifdefstring{\rntz@mathfont}{euler}
              {\RequirePackage{eulervm}}
              {\RequirePackage{newpxmath}}
  \linespread{1.15}

  %% HACK: newpxtext doesn't respect fontaxes' \tbfigures! :( but it _does_
  %% define, eg., \tlfstyle! hm...
  \RequirePackage{fontaxes}
  \renewcommand\tbfigures{}
  \renewcommand\lnfigures{}
}{}

\ifdefstring{\rntz@font}{pt}{
  \RequirePackage[scaled=0.93]{PTSerif}
  \RequirePackage[scaled=0.93]{PTSans}
  %% PTSans doesn't have small caps; could use biolinum or sourcesanspro instead.
  %\RequirePackage[scaled=1.135]{biolinum}
  \RequirePackage[scaled=1.04]{inconsolata}
  \ifdefstring{\rntz@mathfont}{euler}{\RequirePackage{eulervm}}{
    \RequirePackage[utopia,scaled=1.05726]{newtxmath}
  }
  \linespread{1.126}
}{}
